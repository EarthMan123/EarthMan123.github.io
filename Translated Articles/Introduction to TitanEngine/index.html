
<!doctype html>
<html lang="ar" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://EarthMan123.github.io/Translated%20Articles/Introduction%20to%20TitanEngine/">
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.7">
    
    
      
        <title>Introduction to TitanEngine - EarthMan123's PlayGround</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="rtl" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#titanengine" class="md-skip">
          انتقل إلى المحتوى
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="EarthMan123&#39;s PlayGround" class="md-header__button md-logo" aria-label="EarthMan123's PlayGround" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EarthMan123's PlayGround
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Introduction to TitanEngine
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="بحث" placeholder="بحث" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="EarthMan123&#39;s PlayGround" class="md-nav__button md-logo" aria-label="EarthMan123's PlayGround" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    EarthMan123's PlayGround
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Translated Articles
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Translated Articles" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Translated Articles
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Introduction to TitanEngine
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Introduction to TitanEngine
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="جدول المحتويات">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      جدول المحتويات
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#earthman123" class="md-nav__link">
    EarthMan123 : ترجمة
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    المحتويات
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#titanengine_1" class="md-nav__link">
    مقدمة عن TitanEngine
  </a>
  
    <nav class="md-nav" aria-label="مقدمة عن TitanEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    مقدمة عن مفككات الضغط الثابتة
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    مقدمة عن مفككات الضغط التفاعلية
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    مقدمة عن مفككات الضغط العامة
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    بنية مفككات الضغط التفاعلية
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    المراجع والأدوات
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="جدول المحتويات">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      جدول المحتويات
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#earthman123" class="md-nav__link">
    EarthMan123 : ترجمة
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    المحتويات
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#titanengine_1" class="md-nav__link">
    مقدمة عن TitanEngine
  </a>
  
    <nav class="md-nav" aria-label="مقدمة عن TitanEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    مقدمة عن مفككات الضغط الثابتة
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    مقدمة عن مفككات الضغط التفاعلية
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    مقدمة عن مفككات الضغط العامة
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    بنية مفككات الضغط التفاعلية
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    المراجع والأدوات
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <div class="main" style="text-align: center; color: red; direction: ltr;">
<h1 id="titanengine"><strong>TitanEngine  |  نبذة عن</strong><a class="headerlink" href="#titanengine" title="Permanent link">&para;</a></h1>
<hr />
<hr />
<h3 id="earthman123"><strong>EarthMan123 : ترجمة</strong><a class="headerlink" href="#earthman123" title="Permanent link">&para;</a></h3>
<hr />
<hr />
<hr />
<hr />
<h2 id="_1"><strong>المحتويات</strong><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<hr />
</div>
<div class="content" style="text-align: justify; direction: rtl;">
<ul>
<li><a href="#titanengine_1"><strong>مقدمة عن TitanEngine</strong></a><ul>
<li><a href="#_2"><strong>مقدمة عن مفككات الضغط الثابتة</strong></a></li>
<li><a href="#_3"><strong>مقدمة عن مفككات الضغط التفاعلية</strong></a></li>
<li><a href="#_4"><strong>مقدمة عن مفككات الضغط العامة</strong></a></li>
</ul>
</li>
<li><a href="#_5"><strong>بنية مفككات الضغط التفاعلية</strong></a></li>
<li><a href="#_6"><strong>المراجع والأدوات</strong></a></li>
</ul>
<h2 id="titanengine_1"><strong>مقدمة عن TitanEngine</strong><a class="headerlink" href="#titanengine_1" title="Permanent link">&para;</a></h2>
<p><b>
&emsp;&emsp;أحد أعظم تحديات الهندسة العكسية الحديثة هي تفكيك وتحليل حمايات البرامج. ظهرت عدة منها على مدى العقد الماضي. تطورت حماية البرامج كمؤسسة من الحمايات البسيطة التي تحمي الملفات التنفيذية وأجزاء البيانات إلى الحمايات الحالية عالية التعقيد والتي تأتي غالبا مع خدع تهدف لإبطاء عملية الهندسة العكسية. ويلاحظ أن مثل هذه التقنيات في تزايد كل سنة. لذا وجب علينا سؤال أنفسنا, أيمكننا مواكبة ذلك بالأدوات التي نملكها حاليا؟
<br>&emsp;&emsp;تطورت الحمايات خلال القليلة الماضية, مقابل حدوث تطور في أدوات المهندسين العكسيين , لازالت بعض هذه الأدوات تستخدم حتى يومنا هذا؛ لأنها صممت لمعالجة مشاكل معينة, أو على الأقل أجزاء منها. ولكن عند العودة إلى كتابة مفككات الضغط فإنه يبدو جليا بأن هذه العملية لم تتطور بالشكل المطلوب. نحن منحصرون على كتابة شفرة لكل سيناريو في هذا المجال.
<br>&emsp;&emsp;صممنا TitanEngine بنمط يجعل المحلل قادرا على كتابة مفككات ضغط قادرة على محاكاة عملية فك الضغط اليدوي. مجموعة مكتبات أساسية -والتي ستصبح فيما بعد بنية- لديها وظائف أشهر أربعة أدوات مستخدمة في عملية فك الضغط اليدوي: المنقحات, المفرغات, المستوردات وأدوات إعادة التنظيم. بواسطة التنفيذ الموجه ومجموعة من الـ callbacks فإن هذه الوحدات المنفصلة تكمل بعضها الآخر متوافقة -نوعاً ما- مع الطريقة التي يمكن لأي مهندس عكسي أن يستخدم أدواته المفضلة في فك ضغط الملف. هذا يوجد تسلسل زمني للتنفيذ يتفادى تنفيذ الحماية ويجمع المعلومات منه بينما يُوجَّه إلى النقطة التي تقوم الحماية فيها بنقل التحكم إلى شفرة البرنامج الأصلية. عند الوصول إلى هذه النقطة يتم تفريغ الملف إلى القرص ويتم إصلاحه بحيث يماثل الأصلي إلى أقصى حد ممكن. وعلى هذا النمط نكون قد وجدنا حلاً لمشكلة مفككات الضغط الثابتة. ولازال فك الضغط اليدوي حتى الآن يعتبر مهماً لأنه يعتبر الأكثر أماناً, وفي معظم الحالات أسرع طريقة موجودة. لأجل ذلك سنناقش كلاً من مفككات الضغط الثابتة والتفاعلية. وسننظر ايضاً في طرق عمل شفرة عامة لدعم عدد كبير من البنى بدون معرفة تفاصيل كل بنية.
<br>&emsp;&emsp;يمكن وصف TitanEngine بأنه أداة متعددة الوظائف للمهندس العكسي. بوظائفها الـ 250 تعتبر محتوية في بنيتها على عمل كل أداة هندسة عكسية صنعت حتى يومنا هذا. والأفضل من ذلك, يمكن جعل TitanEngine يعمل بشكل آلي. بل حتى أنه يمكن استخدامه لأكثر من فك ضغط الملفات. فيمكن استخدامه لصناعة أدوات جديدة تتعامل مع الملفات التنفيذية. داعمة لنظامي x86 و x64, ما يجعل هذا الهيكل, هو الوحيد الداعم للتعامل مع ملفات نظامي x86 و x64. لأجل ذلك, يمكن استخدامه لصناعة جميع أنواع مفككات الضغط المعروفة. المحرك مفتوح المصدر مما يجعله مفتوحاً امام التعديلات التي ستسهل من اندماجه مع الحلول القائمة, وسيفسح المجال أمام صناعة حلول جديدة تناسب احتياجات المشاريع المختلفة.
</b></p>
<ul>
<li><strong>تحتوى TitanEngine SDK على :</strong><ul>
<li>منقح x64/x86 مدمج</li>
<li>مفكك x64/x86 مدمج</li>
<li>مفرغ ذاكرة مدمج</li>
<li>متتبع ومصلح import مدمج</li>
<li>مصلح relocation مدمج</li>
<li>realigner مدمجة</li>
<li>وظائف للتعامل مع TLS, الموارد, الدوال المصدرة,...</li>
</ul>
</li>
</ul>
<h3 id="_2"><strong>مقدمة عن مفككات الضغط الثابتة</strong><a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p><b>
&emsp;&emsp;معظم مفككات الضغط البسيطة من النوع الثابت. أخذنا هذه الملاحظة بشكلٍ تقريبـي, لأن هذا يعتمد على مدى تعقيد البنية التي يتم فك ضغطها. في معظم الحالات كتابة مثل تلك المفككات يعتبر بسيطاً بسبب أن البنية التي يتم فكها بسيطة ويشار إليها غالباً بالتشفير.
<br>&emsp;&emsp;هذا النوع من حمايات الملفات التنفيذية (لأن التحزيم نوع بسيط من أنواع الحماية) تمتلك بنية تشفر فقط الشفرة والموارد, وفي بعض الحالات تأخذ دور محمِّل جدول الاستدعاء . حتى وإن قابلنا التمثيل الأكثر تطوراً لهذه الحماية فلن يختلف كثيراً عن النموذج البسيط. والذي بدوره ليس سوى إضافة أقسام جديدة للملف لكود التشفير وكذاك تشفير كود البرنامج وموارده مع احتمالية القيام بدور المحمِّل لجذر (STUB) المشفر. وبما أن هذه التعديلات لا تؤثر على الملف بحيث يلزم إعادة بنائه بشكل كبير, فإن لدى المفككات الثابتة نموذج عام وهو : الحصول على البيانات اللازمة لفك تشفير الأجزاء المشفرة ثم إعادة بناء جدول الاستدعاء متبوعاً بحذف أقسام المشفر.
<br>&emsp;&emsp;برغم الاختلافات البسيطة للإرشادات الموضحة بالأعلى فإنه يمكن اعتبار هذا كنموذج تشفير بسيط. قد تكون هذه الاختلافات في أماكن كود المشفر, الطريقة التي يتعامل بها مع الدوال المستدعاة أو في القيام ببعض الحماية مثل : حماية نقطة الدخول, إعادة توجيه الدوال, eliminations, code splices, code markers إلخ.
<br>&emsp;&emsp;ومع ذلك فإنه يمكن استخدام المفككات الثابتة لحالة أصعب قد تحتاج إلى إعادة بناء كاملة للملف حتى تكتمل عملية فك الضغط. في مثل هذه الحالات يفضل استخدام مفككات الضغط الثابتة فقط إذا كان الأمان ذو أهمية حساسة. غالباً ما تحتاج هذه الحالات إلى التعرف على خوارزمية الضغط المستخدمة وتلاؤمها مع شفرتنا. وهذا يحتاج إلى عمل دقيق وفهم شامل للخوارزمية المستخدمة في فك الضغط. هناك بعض خوارزميات الضغط القياسية المستخدمة في معظم البرامج التنفيذية, لذا يمكننا استخدام هذه المعلومة لبناء قاعدة بيانات موازية من خوارزميات فك الضغط لتسهيل عملية كتابة المفككات. لا يهم أي طريق اخترناه, ويجب علينا دائماً التحقق من إن كانت الخوارزمية قد تغيرت, لأن هذه إحدى طق التلاعب بمفككات الضغط. وتعتبر مفككات الضغط التفاعلية مرنة في مثل هذه الحالات.
</b>
<br><br>
<img alt="Figure 1" src="../images/Introduction%20to%20TitanEngine/Figure%201.png" /></p>
<h3 id="_3"><strong>مقدمة عن مفككات الضغط التفاعلية</strong><a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p><b>
&emsp;&emsp;أشهر مفككات الضغط هي التفاعلية.هذا النموذج هو المستخدم كثيراً؛ لسهولة تطبيقه وكذلك لمرونته أمام التغييرات الطفيفة في فك ضغط التشفير وكذلك خوارزميات فك الضغط. ولكن يجب أخذ أمان النظام بعين الاعتبار بسبب أن الملفات يتم تنفيذها خلال عملية فك الضغط. فهناك احتمال أن يتم تنفيذ الملفات خارج إطار عملية فك الضغط أو حتى بقائها عالقة في حلقات لا نهائية. بالاستطاعة تجنب هذا الشيء بواسطة تطبيق مفكك الضغط. أكثر اختيارٍ منطقي هو إنشاء صندوق وهمي ((sandbox داخلي لأجل عملية فك الضغط نفسها.
<br>&emsp;&emsp;يستخدم فك الضغط التفاعلي على أنواع محددة. بحيث لدى هذه الأنواع بنية تنفيذ أكثر تعقيداً بالإضافة إلى أن محتوى هذه الملفات ليس مشفراً فقط بل مضغوطاً كذلك. لتجنب ثقل إعادة التجميع للملف؛ نقوم بتنفيذه إلى أن نصل إلى نقطة الدخول الأصلية والتي بدورها تعتبر أول تعليمة من تعليمات الكود الأصلي قبل أن تتم حمايته. برغم أنه يمكن استخدام هذا النوع لفك ضغط جميع الملفات إلا أنه يستخدم فقط على البرامج المحمية, المضغوطة, المحزمة ,أو الهجينة-التي تحتوى على أكثر من نوع.
<br>&emsp;&emsp;تحتوي البنية الأساسية لمثل هذه الحمايات على أقسام الملف والبيانات الهامة مضغوطةً, وربما محمية بكونها مشفرة. يوجد الجذر (STUB) عادة في آخر قسم من أقسام الملف. وقبل الضغط يتم إما حفظ بنية الأقسام أو دمج جميع الأقسام بقسم واحد. تتضمن الحالة الأولى احتواء كل قسم على محتوياته الأصلية مضغوطة فقط, بينما تتضمن الحالة الثانية على قسم فارغ يعمل كمساحة ذاكرة افتراضية احتياطية. في هذه الحالة تكون البيانات المضغوطة محفوظة في قسم الجذر (STUB) وعند فك ضغطها تتم إعادتها إلى أماكنها الأصلية.
<br>&emsp;&emsp;من المهم دائماً عند إنشاء مفككات الضغط التفاعلية التحكم بنموذج عملية التنفيذ. فقد يحدث في أي نقطة أن تفقد السيطرة على عملية التنفيذ مما يؤدي إلى نتائج غير متوقعة. علاوةً على ذلك، يجب القيام بعملية فك الضغط في بيئة آمنة ما يعني ضرورة تصميم صندوق وهمي (sandbox). هذا بالإضافة إلى عدة فحوصات أخرى التي تجري قبل وخلال عملية فك الضغط يضمن احتفاظنا بأقصى تحكم ممكن خلال هذه العملية الخطيرة. لدى هذا النوع من المفككات نموذج قياسي سيتم مناقشته في بنية مفككات الضغط التفاعلية ويعتبر نوع أساسي من أنواع المفككات التي يمكن صناعتها بواسطة TitanEngine الذي تعتبر غالبية وظائفه مكرسة للكتابة.
</b>
<br><br>
<img alt="Figure 2" src="../images/Introduction%20to%20TitanEngine/Figure%202.png" /></p>
<h3 id="_4"><strong>مقدمة عن مفككات الضغط العامة</strong><a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p><b>
&emsp;&emsp;أكثر الطرق صعوبة في صناعة مفككات الضغط هي صناعة مفككات الضغط العامة. على العكس تماماً من الحالتين السابقتين, عند صناعة المفككات العامة فلا تحتاج للقلق حول استخراج عدد جيد من الأنماط من قسم الكود لأجل صناعة توقيع لمفككك. يعتبر الأمر بسيطاً إلى حدٍ ما؛ لأن هذه المفككات لا تهتم بتفاصيل الملف, بل تهتم بسلوكها العام والذي يعتبر شائعاً للحمايات من نفس النوع. هذا يعني بأنه لا توجد مفكك ضغط عام صالح لكل الحالات, بل عدد واسع من مفككات الضغط العامة التي تستهدف سلوك أنواع محددة من البرامج.
<br>&emsp;&emsp;سنركز فقط حول مفككات الضغط العامة للبرامج المحمية ونعرض عدد واسع من الخوارزميات العامة التي تستهدف هذا النوع. التحدي الأساسي هنا هو الحفاظ على أكبر قدر من التحكم بدون إبطاء شديد لعملية فك الضغط. يحدث التباطؤ بسبب استخدام نقاط توقف الذاكرة لمراقبة وصول الملف المضغوط إلى الأقسام القابلة للتنفيذ. إذا قمنا بإعادة ضبط نقاط توقف الذاكرة في كل مرة يصل فيها الضاغط إلى القسم فإننا بذلك نؤثر بشكل كبير في السرعة وإن لم نفعل ذلك فقد نخاطر بعد إمساك حدث القفز إلى نقطة الدخول الأصلية وبل حتى تنفيذ البرنامج. هناك بعض الطرق لعمل ذلك ولك أحدها هي الشائعة.
<br>&emsp;&emsp;غالباً ما تستخدم مفككات الضغط العامة توقيت دالة WaitForDebugEvent لإعادة ضبط نقاط التوقف حالما يتم الوصول إليها. يمكن التوقف عند نقاط توقف الذاكرة في ثلاث حالات : عندما تتم القراءة منها, الكتابة إليها, أو تنفيذها.  وبما أننا فقط نضع نقاط توقف الذاكرة في الأماكن التي نتوقع أن تكون نقطة الدخول فيها, اذا نحن مهتمون فقط في حالة التنفيذ. للتحقق مما إن كانت الذاكرة يتم تنفيذها أم لا, فيكفي التحقق من مسجل EIP لرؤية إن كانت يطابق القسم المراد. ويمكننا مع ذلك وضع نقطة توقف على القسم الذي يحتوي كود الضاغط. وبهذا يمكننا تعقب ما إذا تمت الكتابة للقسم قبل تنفيذه. إذا تمت الكتابة فيه فهناك احتمال كبير بأن نقطة الدخول تكمن فيه وأننا في المكان الصحيح. يمكننا تعقب الكتابة للقسم بواسطة نقاط توقف الذاكرة, ويمكن أيضاً التحقق هاش (hash) القسم للتأكد من أن كانت البيانات قد تغيرت بالفعل. آخر تحقق يجب أنجازه قبل تقرير مما إن كنا سنقف على نقطة دخول محتملة هو التحقق من إعادة التوجيه (redirections) البسيطة المعروفة التي تستخدمها الضاغطات مثل ASPack لخداع الخوارزميات العامة. بمجرد تثبتنا من هذا يمكننا التأكد من أننا وجدنا نقطة الدخول. لإكمال عملية فك الضغط يحب علينا أن نفرغ الذاكرة ونعالج جدول الاستدعاء والذي يمكن فعل ذلك بواسطة TitanEngine.
</b>
<br><br>
<img alt="Figure 3" src="../images/Introduction%20to%20TitanEngine/Figure%203.png" /></p>
<h2 id="_5"><strong> بنية مفككات الضغط التفاعلية </strong><a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p><b>
&emsp;&emsp;يجب عليك حتى تستطيع استخدام TitanEngine SDK ان تعرف بأي ترتيب يجب عليك استدعاء الـدوال (APIs). الترتيب إلزامي, ستكون بنية مفكك الضغط الخاص بك على الأغلب مشابهة. كل مفكك ضغط يبدأ بتنقيح ووضع نقطة توقف في نقطة الدخول للهدف. بعد هذا, يجب عليك أن تنقح البرنامج بتنفيذه حتى كود تجهيز الـ IAT يستخدم هذا الكود دالة LoadLibrary أو دالة GetModuleHandle لتحميل ملفات dll التابعة و دالة GetProcAddress لإيجاد أماكن الدوال المطلوبة. يجب عليك عند الانتهاء من هذا التوقف على نقطة الدخول الأصلية, تفريغ الملف, ثم لصق دوال الاستدعاء به.
<br>&emsp;&emsp;يجب عليك أولاً لبدء التنقيح أن تجد عنوان نقطة الدخول الأصلية. يمكنك القيام بذلك بواسطة استدعاء دالة GetPE32Data وتحميل بيانات العنوان الرئيسي (ImageBase) و نقطة الدخول الأصلية (OriginalEntryPoint). مجموع هاتان القيمتان هو عنوان نقطة الدخول. قم بعد الانتهاء من هذا من بتهيئة التنقيح بواسطة استدعاء دالة InitDebug. هذه الدالة تنشئ العملية المنقحة ولكنها لا تبدأ عملية التقيح الفعلية. تكون العملية في هذه الحالة معلقة (suspended), لذا يجب عليك استدعاء SetBpx لوضع نقطة التوقف الرئيسة عند نقطة الدخول الأصلية. سيتم استدعاء نداء نقطة التوقف العكسي فور انتهاء العملية المنقحة من التحميل. ويجب عليك لإيصال عملية التنقيح إلى هذه النقطة استدعاء دالة DebugLoop. يسيطر المنقح بعد استدعائها على عملية التنقيح. في هذه النقطة, الطريقة الوحيدة للتحكم في  عملية التنقيح هي باستخدام إجراءات النداء العكسي (callback procedures). توضع النداءات العكسية مع جميعأنواع نقاط التوقف. لذا إن وضعت نقطة توقف على نداء نقطة الدخول الأصلية فإن أول نداء عكسي (callback) لدالة DebugLoop يتم استدعاؤه هو النداء العكسي  لنقطة التوقف الخاصة بنقطة الدخول الأصلية. استخدم ذاك النداء العكسي لوضع بقية نقاط التوقف.
<br>&emsp;&emsp;أفضل طريقة لإيجاد مكان وضع نقطة التوقف هي باستخدام دالة Find. ستخبرك بمكان إيجاد النمط الذي تبحث. إذا كان الضاغط الذي تكتب مفكك ضغط له ذو طبقة واحدة فيمكنك وضع جميع نقاط التوقف ف أول أو قبل أول نداء عكسي (callback), الموجود في نقطة الدخول الأصلية. للحصول على جميع البيانات اللازمة لإصلاح الـ IAT تحتاج إلى وضع نقطتين إلى ثلاث نقاط. الأولى في نداء إما دالة LoadLibrary أو نداء دالة GetModuleHandle, الثانية عند نداء GetProcAddress (استخدم نقطتي توقف إذا كان الضاغط يستدعي دالة GetProcAddress بمكانين لأجل إيجاد نص الدالة وكذلك لإيجاد ترتيب الدالة). ولكن قبل استطاعتك استدعاء أيٍ من دوال الاستيراد لجمع بيانات الـ IAT؛ يجب عليك استدعاء دالة ImporterInit لتهيئة المستورد.
<br>&emsp;&emsp;يجب عليك بعد قيامك بهذا ووضع نقاط التوقف أن تبرمج النداءات العكسية لنقاط التوقف للحصول على بيانات IAT. في النداء العكسي لـLoadLibrary /GetModuleHandle أنت تستدعي دالة ImporterAddNewDll. أحد معاملاتها هو النص الذي يحمل اسم ملف الـ dll الذي حُمِّل. مكان هذه البيانات موجود في إما أحد المسجلات أو في عنوان معين في الذاكرة. استدع دالة GetContextData لأجل الحصول على هذه البيانات. إذا كانت البيانات عبارة عن مكان حيث النص موجود وليست عدد مرتباً فإذا يجب عليك استدعاء دالة ReadProcessMemory لقراءة اسم الـ dll من العملية المنقحة. يمكنك عندئذ إضافة الـ dll إلى محرك الاستيراد (importer engine). انتبه إلى أنه بمجرد إضافتك للـ dll باستدعاء دالة ImporterAddNewDll فإن جميع النداءات إلى دالة ImporterAddNewAPI تضيف الدوال (APIs) إلى آخر ملف dll تمت إضافته. تضاف الدوال بواسطة استدعاء دالة ImporterAddNewAPI بنفس طريقة إضافتك لملف dll جديد إلى محرك الاستيراد (importerengine). ولكن بعكس دالة ImporterAddNewDll يجب عليك هنا أن تحدد المكان الذي سيخزن فيه مؤشر الدالة ((API pointer. هذا عبارة عن مكان في الذاكرة تمت كتابة المؤشر الذي حُمِّل بواسطة دالة GetProcAddress فيه. بعد جمعك لكل البيانات المطلوبة  لتعبئة الـ IAT, فإن عملية فك الضغط تقترب من اكتمالها.
<br>&emsp;&emsp;يمكنك الآن تحميل نقطة الدخول الأصلية (OEP) للملف المفكوك ( هذا يعتمد على كود الضاغط) وتفريغ العملية المنقحة بواسطة دالة DumpProcess. بعد هذا يمكنك استخدام دالة AddNewSection لإضافة المساحة المطلوبة للصق الـ IAT في الملف المفرغ (dumped file). ولمعرفة المساحة المطلوبة فأنت بحاجة لاستخدام دالة ImporterEstimatedSize. وأخيراً يتم تصدير الـ IAT إلى القسم الجديد باستدعاء دالة ImporterExportIAT. يمكنك اختيارياً (إذا أحببت) أن تعيد تنظيم الملف ثم بعد ذلك إيقاف عملية التنقيح بواسطة استدعاء دالة StopDebug ( إذا لم توقف الهدف المنقح فإنه سيبقى مشغلاً). هذا ينهي العملية المنقحة ثم بعد ذلك سيستمر تنفيذ البرنامج بعد استدعاء دالة DebugLoop.
</b>
<br><br>
<img alt="Figure 4" src="../images/Introduction%20to%20TitanEngine/Figure%204.png" /></p>
</div>
<p><br><br></p>
<h2 id="_6"><strong>المراجع والأدوات</strong><a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<ul>
<li>[1] <strong><a href="https://www.reversinglabs.com">TitanEngine 2.0 SDK</a></strong></li>
<li>[2] <strong><a href="https://blackhat.reversinglabs.com">Slides &amp; Whitepaper: BlackHat, Vegas 2009</a></strong></li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../.." class="md-footer__link md-footer__link--prev" aria-label="السابقة: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                السابقة
              </span>
              Home
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "\u0646\u0633\u062e \u0625\u0644\u0649 \u0627\u0644\u062d\u0627\u0641\u0638\u0629", "clipboard.copied": "\u062a\u0645 \u0627\u0644\u0646\u0633\u062e \u0627\u0644\u0649 \u0627\u0644\u062d\u0627\u0641\u0638\u0629", "search.config.lang": "en", "search.config.pipeline": " ", "search.config.separator": "[\\s\\-]+", "search.placeholder": "\u0628\u062d\u062b", "search.result.placeholder": "\u0627\u0643\u062a\u0628 \u0644\u0628\u062f\u0621 \u0627\u0644\u0628\u062d\u062b", "search.result.none": "\u0644\u0627 \u062a\u0648\u062c\u062f \u0646\u062a\u0627\u0626\u062c", "search.result.one": "\u0646\u062a\u0627\u0626\u062c \u0627\u0644\u0628\u062d\u062b \u0645\u0633\u062a\u0646\u062f \u0648\u0627\u062d\u062f", "search.result.other": "\u0646\u062a\u0627\u0626\u062c \u0627\u0644\u0628\u062d\u062b # \u0645\u0633\u062a\u0646\u062f\u0627\u062a", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.b0710199.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.76f349be.min.js"></script>
      
    
  </body>
</html>